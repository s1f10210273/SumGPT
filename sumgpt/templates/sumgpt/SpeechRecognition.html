<!DOCTYPE html>
{% extends "sumgpt/base.html" %}

{% block title_block %}
index
{% endblock %}

{% block body_block %}
<div class="container">
    <div class="row mt-5">
        <div class="col-md-6 offset-md-3">
            <div class="mb-3">
                <h1 class="bold-text text-center">SumGPT</h1>
                <button id="startButton" class="btn btn-secondary">éŸ³å£°èªè­˜é–‹å§‹</button>
                <button id="stopButton" class="btn btn-danger" style="display:none;">éŸ³å£°èªè­˜çµ‚äº†</button>
                <button id="rec" class="btn btn-danger" type="button" disabled style="display:none;">
                    <span class="spinner-grow spinner-grow-sm" role="status" aria-hidden="true"></span>
                    éŒ²éŸ³ä¸­
                </button>


                {% comment %} æ¥­ç•ŒæŒ‡å®šã®å®Ÿè£… {% endcomment %}
                <select id="inputState" class="form-select">
                    <option selected>æ¥­ç•Œã‚’æŒ‡å®š</option>
                    {% comment %} ä¸‹ã®[selectedOption]ã«ã¯ã€ã“ã®valueã®å€¤ãŒå…¥ã‚‹ {% endcomment %}
                    <option value="1">è¾²æ¥­ãƒ»æ—æ¥­ãƒ»æ¼æ¥­</option>
                    <option value="2">å»ºè¨­æ¥­</option>
                    <option value="3">é›»æ°—ãƒ»ã‚¬ã‚¹ãƒ»ç†±ä¾›çµ¦ãƒ»æ°´é“æ¥­</option>
                    <option value="4">è£½é€ å·</option>
                    <option value="5">é‹è¼¸æ¥­</option>
                    <option value="6">æƒ…å ±é€šä¿¡æ¥­</option>
                    <option value="7">å¸å£²ãƒ»å°å£²æ¥­</option>
                    <option value="8">é‡‘èãƒ»ä¿é™ºæ¥­</option>
                    <option value="9">é£²é£Ÿãƒ»å®¿æ³Šæ¥­</option>
                    <option value="10">ä¸å‹•ç”£æ¥­</option>
                    {% comment %} æ¥­ç•Œã‚’å¢—ã‚„ã—ã¦ã„ããŸã„ã§ã™ã­ğŸ˜€ {% endcomment %}
                </select>


            </div>
            <div class="mb-3">
                <form method="post" action="{% url 'sp' %}">
                {% csrf_token %}
                <textarea name="data" id="re" class="form-control" cols="30" rows="10" readonly></textarea>
                <button type="submit" id="sumButton" class="btn btn-secondary" style="display:none;">è¦ç´„</button>
            </form>
            </div>
            <div id="transcription" class="mt-3"></div>
        </div>
    </div>
</div>

<script>
        let isRecognizing = false;
        //APIã®åˆæœŸè¨­å®š
        const recognition = new webkitSpeechRecognition();
        recognition.lang = 'ja-JP';
        recognition.interimResults = true;
        recognition.continuous = true;

        //DOMè¦ç´ ã®èª­ã¿è¾¼ã¿
        const startButton = document.getElementById('startButton');
        const stopButton = document.getElementById('stopButton');
        const rec = document.getElementById('rec');
        const sumButton = document.getElementById('sumButton');
        const re = document.getElementById('re');

        //ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ™‚ã®æ“ä½œ
        startButton.addEventListener('click', () => {
            isRecognizing = false;
            if (!isRecognizing) {


                    //å˜èªç™»éŒ²
                    const grammar = '#JSGF V1.0 JIS ja; grammar numbers; public <numbers> = æ±ºå®š | åˆ¤æ–­ | ç†ç”± | æ¡ˆä»¶ | å¦æ±º | å†æ¤œè¨ | å†èª¿æ•´ | ä¿ç•™ | è³‡æ–™ | è£œè¶³è³‡æ–™ | å‚è€ƒæ„è¦‹ | ç¤¾é•·ä¸€ä»» | ã‚¢ã‚µã‚¤ãƒ³ ;';

                    const SpeechGrammarList = window.webkitSpeechGrammarList || window.SpeechGrammarList;
                    const speechRecognitionList = new SpeechGrammarList();
                    speechRecognitionList.addFromString(grammar, 1);

                    //æ¥­ç•Œé¸æŠã‚’ã—ãŸå ´åˆã®å‡¦ç†
                    const selectElement = document.getElementById("inputState");
                    const selectedOption = selectElement.options[selectElement.selectedIndex].value;
                    if (selectedOption == 1) {
                        const customGrammar = '#JSGF V1.0 JIS ja; grammar numbers; public <numbers> = ä¾¡æ ¼å‡ä¸€åŒ– | å¸Œå°‘æ€§ | å®‰å®šä¾›çµ¦ | ãƒ–ãƒ©ãƒ³ãƒ‰ | ãƒªã‚µã‚¤ã‚¯ãƒ« | å†ç”Ÿææ–™ãƒ»ãƒªã‚µã‚¤ã‚¯ãƒ«ææ–™ | ä¼æ¥­ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ | æ‰‹ä½œã‚Šç”Ÿç”£ | ç‹¬è‡ªæŠ€è¡“ | æœ‰æ©Ÿæ ½åŸ¹ | å—è¨—ç”Ÿç”£ | ç‰¹è¨±ä¿æœ‰ | è²©å£²åº—è²©å£² | ãƒã‚§ãƒ¼ãƒ³å±•é–‹ | ã‚¿ã‚¤ã‚¢ãƒƒãƒ—è²©å£² | ã‚µãƒ³ãƒ—ãƒ«è²©å£² | ä¿è¨¼æœŸé–“å»¶é•· | ãƒˆãƒ¬ãƒ¼ã‚µãƒ“ãƒªãƒ†ã‚£ ;';
                        speechRecognitionList.addFromString(customGrammar, 1);
                        }

                    else if (selectedOption == 2) {
                        const customGrammar = '#JSGF V1.0 JIS ja; grammar numbers; public <numbers> = ä¾¡æ ¼å‡ä¸€åŒ– | ç‹¬è‡ªæŠ€è¡“ | å¸Œå°‘æ€§ | ä¿¡é ¼æ€§ | é«˜æŠ€èƒ½äººæ | å†ç”Ÿææ–™ãƒ»ãƒªã‚µã‚¤ã‚¯ãƒ«ææ–™ | ç›´æ¥ä»•å…¥ã‚Œ | ãƒ—ãƒ¬åŠ å·¥ç”Ÿç”£ | ç¾å ´åŠ å·¥ | ç‹¬è‡ªæŠ€è¡“ | å—è¨—ç”Ÿç”£ | ä¸€æ‹¬è«‹è²  | äº‹æ¥­é€£æº | ä¸­é–“æ¤œæŸ» | ç‰¹è¨±ä¿æœ‰ | ç‹¬è‡ªå–¶æ¥­åŠ› | ææ¡ˆè²©å£² | è²©å£²åº—è²©å£² | ãƒã‚§ãƒ¼ãƒ³å±•é–‹ | ã‚¿ã‚¤ã‚¢ãƒƒãƒ—è²©å£² | ä¿è¨¼æœŸé–“å»¶é•· | ä¼šå“¡åˆ¶ | å®šæœŸãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ ;';
                        speechRecognitionList.addFromString(customGrammar, 1);
                        }
                    
                    else if (selectedOption == 3) {
                        const customGrammar = '#JSGF V1.0 JIS ja; grammar numbers; public <numbers> =  |  |  |  |  |  |  |  |  |  |  |  |  ;';
                        speechRecognitionList.addFromString(customGrammar, 1);
                        }
                    
                    else if (selectedOption == 4) {
                        const customGrammar = '#JSGF V1.0 JIS ja; grammar numbers; public <numbers> =  |  |  |  |  |  |  |  |  |  |  |  |  ;';
                        speechRecognitionList.addFromString(customGrammar, 1);
                        }
                    
                    else if (selectedOption == 5) {
                        const customGrammar = '#JSGF V1.0 JIS ja; grammar numbers; public <numbers> =  |  |  |  |  |  |  |  |  |  |  |  |  ;';
                        speechRecognitionList.addFromString(customGrammar, 1);
                        }
                    
                    else if (selectedOption == 6) {
                        const customGrammar = '#JSGF V1.0 JIS ja; grammar numbers; public <numbers> =  |  |  |  |  |  |  |  |  |  |  |  |  ;';
                        speechRecognitionList.addFromString(customGrammar, 1);
                        }
                    
                    else if (selectedOption == 7) {
                        const customGrammar = '#JSGF V1.0 JIS ja; grammar numbers; public <numbers> =  |  |  |  |  |  |  |  |  |  |  |  |  ;';
                        speechRecognitionList.addFromString(customGrammar, 1);
                        }

                    else if (selectedOption == 8) {
                        const customGrammar = '#JSGF V1.0 JIS ja; grammar numbers; public <numbers> =  |  |  |  |  |  |  |  |  |  |  |  |  ;';
                        speechRecognitionList.addFromString(customGrammar, 1);
                        }
                    
                    else if (selectedOption == 9) {
                        const customGrammar = '#JSGF V1.0 JIS ja; grammar numbers; public <numbers> =  |  |  |  |  |  |  |  |  |  |  |  |  ;';
                        speechRecognitionList.addFromString(customGrammar, 1);
                        }

                    else if (selectedOption == 10) {
                        const customGrammar = '#JSGF V1.0 JIS ja; grammar numbers; public <numbers> =  |  |  |  |  |  |  |  |  |  |  |  |  ;';
                        speechRecognitionList.addFromString(customGrammar, 1);
                        }
                
                    //é¸æŠæ¥­ç•Œã‚’å¢—ã‚„ã™ã¨ãã¯ã“ã®ã—ãŸã«æ›¸ã„ã¦ã„ãã®ãŒã„ã„ã‹ã‚‚ï¼ï¼
                    //ä¸Šã®else ifæ–‡ã‚’ã‚³ãƒ”ãƒšã§ã„ã‘ã¾ã™
                    recognition.grammars = speechRecognitionList;



                    console.log(selectedOption);
                    recognition.start();
                    //ä¸‹ã®é–¢æ•°ã®å‘¼ã³å‡ºã—
                    startrec();
                    startButton.style.display = 'none';
                    stopButton.style.display = 'inline-block';
                    rec.style.display = 'inline-block';
                    }
                });

        //ã‚¹ãƒˆãƒƒãƒ—ãƒœã‚¿ãƒ³ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚ŒãŸæ™‚ã®æ“ä½œ
        stopButton.addEventListener('click', () => {
            //ä¸‹ã®é–¢æ•°ã®å‘¼ã³å‡ºã—
            stoprec();
        });

        function startrec() {
            recognition.onresult = (event) => {
                let interimTranscript = '';
                let finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcript = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcript + '\n';
                    } else {
                        interimTranscript += transcript + ' ';
                    }
                }

                document.getElementById('transcription').textContent = interimTranscript.trim();
                re.value = (re.value + finalTranscript).trim() + "\n";
    }
}

        function stoprec() {
            recognition.stop();
            startButton.style.display = 'inline-block';
            stopButton.style.display = 'none';
            rec.style.display = 'none';
            isRecognizing = true;
            if (re.value != '') {
            sumButton.style.display = 'inline-block';
            }
        }

</script>


{% endblock %}